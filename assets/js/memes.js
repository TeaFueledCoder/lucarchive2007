// Always pull from the random folder
const MEME_BASE = "/assets/images/memes/random/";
const MEME_INDEX = "/memes.json"; 
// memes.json is generated by Jekyll (explained below)

// Donâ€™t load memes on small screens
function isMobileish() {
  return window.matchMedia("(max-width: 900px)").matches;
}

// Proper unbiased shuffle
function shuffleInPlace(a) {
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function populateSide(side, names) {
  for (const name of names) {
    const img = document.createElement("img");
    img.src = MEME_BASE + name;
    img.loading = "lazy";
    img.decoding = "async";
    img.alt = "";
    side.appendChild(img);
  }
}

async function runMemes() {
  if (isMobileish()) return;

  const left = document.querySelector(".side.left");
  const right = document.querySelector(".side.right");
  if (!left || !right) return;

  // Fetch the auto-generated list of files
  const res = await fetch(MEME_INDEX, { cache: "no-store" });
  if (!res.ok) return;

  const files = await res.json();
  if (!Array.isArray(files) || files.length === 0) return;

  const shuffled = shuffleInPlace([...files]);

  populateSide(left,  shuffled.slice(0, 3));
  populateSide(right, shuffled.slice(3, 6));
}

document.addEventListener("DOMContentLoaded", runMemes);
